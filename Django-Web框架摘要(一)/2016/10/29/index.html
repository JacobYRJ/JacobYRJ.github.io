<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/VEN/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/VEN/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="本文是Blog主在学习Django时为了方便记忆和加深理解而写，所以部分内容可能无法详述，但是，可以帮助初学者遇到相关问题时提供便利。摘录自：http://djangobook.py3k.cn/2.0/
介绍Django：简介：Django：一个可以使Web开发工作愉快并且高效的Web开发框架。 使用Django，使你能够以最小的代价构建和维护高质量的Web应用。
Django和 Python 3">
<meta property="og:type" content="article">
<meta property="og:title" content="Django Web框架摘要(一)">
<meta property="og:url" content="http://yoursite.com/Django-Web框架摘要(一)/2016/10/29/index.html">
<meta property="og:site_name" content="A Little Boy">
<meta property="og:description" content="本文是Blog主在学习Django时为了方便记忆和加深理解而写，所以部分内容可能无法详述，但是，可以帮助初学者遇到相关问题时提供便利。摘录自：http://djangobook.py3k.cn/2.0/
介绍Django：简介：Django：一个可以使Web开发工作愉快并且高效的Web开发框架。 使用Django，使你能够以最小的代价构建和维护高质量的Web应用。
Django和 Python 3">
<meta property="og:image" content="https://i.gyazo.com/2172a76b85d47c5563de6a6247a8d045.png">
<meta property="og:updated_time" content="2016-10-29T11:45:46.658Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Django Web框架摘要(一)">
<meta name="twitter:description" content="本文是Blog主在学习Django时为了方便记忆和加深理解而写，所以部分内容可能无法详述，但是，可以帮助初学者遇到相关问题时提供便利。摘录自：http://djangobook.py3k.cn/2.0/
介绍Django：简介：Django：一个可以使Web开发工作愉快并且高效的Web开发框架。 使用Django，使你能够以最小的代价构建和维护高质量的Web应用。
Django和 Python 3">
<meta name="twitter:image" content="https://i.gyazo.com/2172a76b85d47c5563de6a6247a8d045.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/Django-Web框架摘要(一)/2016/10/29/"/>


  <title> Django Web框架摘要(一) | A Little Boy </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="default">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">A Little Boy</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">人生苦短</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      
        
        <li class="menu-item menu-item-comments">
          <a href="/comments" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />
            
            comments
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Django Web框架摘要(一)
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-10-29T14:16:52+08:00" content="2016-10-29">
              2016-10-29
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/Django-Web框架摘要(一)/2016/10/29/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="Django-Web框架摘要(一)/2016/10/29/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/Django-Web框架摘要(一)/2016/10/29/" class="leancloud_visitors" data-flag-title="Django Web框架摘要(一)">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">Pengunjung </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>本文是Blog主在学习Django时为了方便记忆和加深理解而写，所以部分内容可能无法详述，但是，可以帮助初学者遇到相关问题时提供便利。<br>摘录自：<a href="http://djangobook.py3k.cn/2.0/" title="The Django Book" target="_blank" rel="external">http://djangobook.py3k.cn/2.0/</a></p>
<h3 id="介绍Django："><a href="#介绍Django：" class="headerlink" title="介绍Django："></a>介绍Django：</h3><h4 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h4><p>Django：一个可以使Web开发工作愉快并且高效的Web开发框架。 使用Django，使你能够以最小的代价构建和维护高质量的Web应用。</p>
<p>Django和 Python 3.0  </p>
<p>在写作本书的时候，Python3.0已经发布，但Django暂时还不支持。 Python3.0这个语言本身引入了大量不向后兼容的改变，因此，我们预期大多数主要的Python库和框架将花几年才能衔接，包括Django。</p>
<p>如果你是个Python新手并且正迷茫于到底是学习Python 2.x还是Python 3.x的话，我们建议你选择Python 2.x。  </p>
<p>(有一点值得注意，上面都是摘录的，如果你认认真真看了原文，并且之前有接触过类似的教程，应该会发现文章缺少了<strong> 虚拟环境env</strong> 这个东西，原文中是直接在本机上安装django，然后开始创建项目，但做过很多次实验后，我个人建议还是先安装<strong>env</strong>，然后再安装django，因为django中涉及一些环境变量的问题，即<strong>DJANGO_SETTINGS_MODULE</strong>，一旦你设置错误，很可能整个项目就运行不了，而且重新开始也会遇到环境变量的问题，所以对初学者来说建议还是用<strong>env</strong>进行）  </p>
<h4 id="安装Trunk版本"><a href="#安装Trunk版本" class="headerlink" title="安装Trunk版本"></a>安装Trunk版本</h4><p>最新最好的django的开发版本称为trunk,可以从django的subversion处获得。 如果你想尝鲜，或者想为django贡献代码，那么你应当安装这个版本。  </p>
<p>Subversion 是一种与 CVS 类似的免费开源版本控制系统，Django 开发团队使用它管理 Django 代码库的更新。 你可以使用 Subversion 客户端获取最新的 Django 源代码，并可任何时候使用 local checkout 更新本地 Django 代码的版本，以获取 Django 开发者所做的最近更新和改进。  </p>
<p>请记住，即使是使用trunk版本，也是有保障的。 因为很多django的开发者在正式网站上就是用的trunk版本，他们会保证trunk版本的稳定性。  </p>
<p>遵循以下步骤以获取最新的 Django 主流代码：  </p>
<blockquote><br>确保安装了 Subversion 客户端。 可以从 <a href="http://subversion.tigris.org/" target="_blank" rel="external">http://subversion.tigris.org/</a> 免费下载该软件，并从 <a href="http://svnbook.red-bean.com/" target="_blank" rel="external">http://svnbook.red-bean.com/</a> 获取出色的文档。<br>（如果你在使用Mac OS X 10.5或者更新的版本，你很走运，Subversion应该就可以安装Django。 你可以在终端上输入svn –version来验证。 )<br>使用<br></blockquote>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">svn co http://code.djangoproject.com/svn/django/trunk djtrunk</div></pre></td></tr></table></figure>
<blockquote><br> 命令查看主体代码。<br>找到你的python的site-packages目录。 一般为/usr/lib/python2.4/site-packages，如果你不确定，可以输入如下命令：<br></blockquote><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python -c &apos;import sys, pprint; pprint.pprint(sys.path)&apos;</div></pre></td></tr></table></figure><br><br><blockquote><br>将 djtrunk/django/bin 加入系统变量 PATH 中。该目录中包含一些像 django-admin.py 之类的管理工具。 此目录包含管理工具，例如：django-admin.py<br></blockquote> 



<h4 id="Django数据库"><a href="#Django数据库" class="headerlink" title="Django数据库"></a>Django数据库</h4><p>Django支持四种数据库：</p>
<ul>
<li>PostgreSQL (<a href="http://www.postgresql.org/" target="_blank" rel="external">http://www.postgresql.org/</a>)</li>
<li>SQLite 3 (<a href="http://www.sqlite.org/" target="_blank" rel="external">http://www.sqlite.org/</a>)</li>
<li>MySQL (<a href="http://www.mysql.com/" target="_blank" rel="external">http://www.mysql.com/</a>)</li>
<li>Oracle (<a href="http://www.oracle.com/" target="_blank" rel="external">http://www.oracle.com/</a>)</li>
</ul>
<p>大部分情况下，这四种数据库都会和Django框架很好的工作。 （一个值得注意的例外是Django的可选GIS支持，它为PostgreSQL提供了强大的功能。）如果你不准备使用一些老旧系统，而且可以自由的选择数据库后端，我们推荐你使用PostgreSQL，它在成本、特性、速度和稳定性方面都做的比较平衡。</p>
<h3 id="视图和URL配置"><a href="#视图和URL配置" class="headerlink" title="视图和URL配置"></a>视图和URL配置</h3><h4 id="view-py"><a href="#view-py" class="headerlink" title="view.py"></a>view.py</h4><p>下面以<strong>“Hello world”</strong>为例，在<strong>views.py</strong>文件下填写下面代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"Hello workd"</span>)</div></pre></td></tr></table></figure></p>
<p>我们逐行逐句分析一遍这段代码：</p>
<blockquote><br>首先，我们从 django.http 模块导入（import） HttpResponse 类。参阅附录 H 了解更多关于 HttpRequest 和 HttpResponse 的细节。 我们需要导入这些类，因为我们会在后面用到。<br><br>接下来，我们定义一个叫做hello 的视图函数。<br><br>每个视图函数至少要有一个参数，通常被叫作request。 这是一个触发这个视图、包含当前Web请求信息的对象，是类django.http.HttpRequest的一个实例。在这个示例中，我们虽然不用request做任何事情，然而它仍必须是这个视图的第一个参数。<br><br>注意视图函数的名称并不重要；并不一定非得以某种特定的方式命名才能让 Django 识别它。 在这里我们把它命名为：hello，是因为这个名称清晰的显示了视图的用意。同样地，你可以用诸如：hello_wonderful_beautiful_world，这样难看的短句来给它命名。 在下一小节（Your First URLconf），将告诉你Django是如何找到这个函数的。<br><br>这个函数只有简单的一行代码： 它仅仅返回一个HttpResponse对象，这个对象包含了文本“Hello world”。<br></blockquote>

<h4 id="urls-py"><a href="#urls-py" class="headerlink" title="urls.py"></a>urls.py</h4><p>前一章中执行 django-admin.py startproject 时，该脚本会自动为你建了一份 URLconf（即 urls.py 文件）。 默认的urls.py会像下面这个样子：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.conf.urls.defaults <span class="keyword">import</span> *</div><div class="line"></div><div class="line"><span class="comment"># Uncomment the next two lines to enable the admin:</span></div><div class="line"><span class="comment"># from django.contrib import admin</span></div><div class="line"><span class="comment"># admin.autodiscover()</span></div><div class="line"></div><div class="line">urlpatterns = patterns(<span class="string">''</span>,</div><div class="line">    <span class="comment"># Example:</span></div><div class="line">    <span class="comment"># (r'^mysite/', include('mysite.foo.urls')),</span></div><div class="line"></div><div class="line">    <span class="comment"># Uncomment the admin/doc line below and add 'django.contrib.admindocs'</span></div><div class="line">    <span class="comment"># to INSTALLED_APPS to enable admin documentation:</span></div><div class="line">    <span class="comment"># (r'^admin/doc/', include('django.contrib.admindocs.urls')),</span></div><div class="line"></div><div class="line">    <span class="comment"># Uncomment the next line to enable the admin:</span></div><div class="line">    <span class="comment"># (r'^admin/', include(admin.site.urls)),</span></div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>当前应该注意是 urlpatterns 变量， Django 期望能从 ROOT_URLCONF 模块中找到它。 该变量定义了 URL 以及用于处理这些 URL 的代码之间的映射关系。 默认情况下，URLconf 所有内容都被注释起来了——Django 应用程序还是白版一块。 （注：那是上一节中Django怎么知道显示欢迎页面的原因。 如果 URLconf 为空，Django 会认定你才创建好新项目，因此也就显示那种信息。<br>如果想在URLconf中加入URL和view，只需增加映射URL模式和view功能的Python tuple即可. 这里演示如何添加view中hello功能.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.conf.urls.defaults <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> mysite.views <span class="keyword">import</span> hello</div><div class="line"></div><div class="line">urlpatterns = patterns(<span class="string">''</span>,</div><div class="line">    (<span class="string">'^hello/$'</span>, hello),</div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>我们做了两处修改:</p>
<ul>
<li>首先，我们从模块 (在 Python 的 import 语法中， mysite/views.py 转译为 mysite.views ) 中引入了 hello 视图。 （这假设mysite/views.py在你的Python搜索路径上。关于搜索路径的解释，请善于利用搜索引擎。）</li>
<li>接下来，我们为urlpatterns加上一行： (‘^hello/$’, hello), 这行被称作URLpattern，它是一个Python的元组。元组中第一个元素是模式匹配字符串（正则表达式）；第二个元素是那个模式将使用的视图函数。</li>
</ul>
<p>如果你想看Python搜索路径的值，运行Python交互解释器，然后输入：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; import sys</div><div class="line">&gt;&gt;&gt; print sys.path</div></pre></td></tr></table></figure></p>
<p>通常，你不必关心 Python 搜索路径的设置。 Python 和 Django 会在后台自动帮你处理好</p>
<h4 id="URLpattern语法"><a href="#URLpattern语法" class="headerlink" title="URLpattern语法"></a>URLpattern语法</h4><p>讨论一下URLpattern的语法是值得的，因为它不是显而易见的。 虽然我们想匹配地址/hello/，但是模式看上去与这有点差别。 这就是为什么：</p>
<blockquote><br>Django在检查URL模式前，移除每一个申请的URL开头的斜杠(/)。 这意味着我们为/hello/写URL模式不用包含斜杠(/)。（刚开始，这样可能看起来不直观，但这样的要求简化了许多工作，如URL模式内嵌，我们将在第八章谈及。）<br><br>模式包含了一个尖号(^)和一个美元符号($)。这些都是正则表达式符号，并且有特定的含义： 上箭头要求表达式对字符串的头部进行匹配，美元符号则要求表达式对字符串的尾部进行匹配。<br><br>最好还是用范例来说明一下这个概念。 如果我们用尾部不是$的模式’^hello/’，那么任何以/hello/开头的URL将会匹配，例如：/hello/foo 和/hello/bar，而不仅仅是/hello/。类似地，如果我们忽略了尖号(^)，即’hello/$’，那么任何以hello/结尾的URL将会匹配，例如：/foo/bar/hello/。如果我们简单使用hello/，即没有^开头和$结尾，那么任何包含hello/的URL将会匹配，如：/foo/hello/bar。因此，我们使用这两个符号以确保只有/hello/匹配，不多也不少。<br><br>你大多数的URL模式会以^开始、以$结束，但是拥有复杂匹配的灵活性会更好。<br><br>你可能会问：如果有人申请访问/hello（尾部没有斜杠/）会怎样。 因为我们的URL模式要求尾部有一个斜杠(/)，那个申请URL将不匹配。 然而，默认地，任何不匹配或尾部没有斜杠(/)的申请URL，将被重定向至尾部包含斜杠的相同字眼的URL。 （这是受配置文件setting中APPEND_SLASH项控制的，参见附件D。）<br><br>如果你是喜欢所有URL都以’/’结尾的人（Django开发者的偏爱），那么你只需要在每个URL后添加斜杠，并且设置”APPEND_SLASH”为”True”. 如果不喜欢URL以斜杠结尾或者根据每个URL来决定，那么需要设置”APPEND_SLASH”为”False”,并且根据你自己的意愿来添加结尾斜杠/在URL模式后.<br></blockquote>

<h4 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h4><p>正则表达式 (或 regexes ) 是通用的文本模式匹配的方法。 Django URLconfs 允许你 使用任意的正则表达式来做强有力的URL映射，不过通常你实际上可能只需要使用很少的一 部分功能。 这里是一些基本的语法。<br><img src="https://i.gyazo.com/2172a76b85d47c5563de6a6247a8d045.png" alt=""><br>另外一个重点，正则表达式字符串的开头字母“r”。 它告诉Python这是个原始字符串，不需要处理里面的反斜杠（转义字符）。 在普通Python字符串中，反斜杠用于特殊字符的转义。比如n转义成一个换行符。 当你用r把它标示为一个原始字符串后，Python不再视其中的反斜杠为转义字符。也就是说，“n”是两个字符串：“”和“n”。由于反斜杠在Python代码和正则表达式中有冲突，因此建议你在Python定义正则表达式时都使用原始字符串。 从现在开始，本文所有URL模式都用原始字符串。</p>
<h4 id="URL配置和松耦合"><a href="#URL配置和松耦合" class="headerlink" title="URL配置和松耦合"></a>URL配置和松耦合</h4><p>Django和URL配置背后的哲学： 松耦合 原则。 简单的说，松耦合是一个 重要的保证互换性的软件开发方法。</p>
<p>Django的URL配置就是一个很好的例子。 在Django的应用程序中，URL的定义和视图函数之间是松 耦合的，换句话说，决定URL返回哪个视图函数和实现这个视图函数是在两个不同的地方。 这使得 开发人员可以修改一块而不会影响另一块。</p>
<p>例如，考虑一下current_datetime视图。 如果我们想把它的URL 从原来的 /time/ 改变到 /currenttime/ ，我们只需要快速的修改一下URL配置即可， 不用担心这个函数的内部实现。 同样的，如果我们想要修改这个函数的内部实现也不用担心会影响 到对应的URL。</p>
<p>此外，如果我们想要输出这个函数到 一些 URL， 我们只需要修改URL配置而不用 去改动视图的代码。 在这个例子里，current_datetime被两个URL使用。 这是一个故弄玄虚的例子，但这个方法迟早会用得上。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">urlpatterns = patterns(<span class="string">''</span>,</div><div class="line">    (<span class="string">'^hello/$'</span>, hello),</div><div class="line">    (<span class="string">'^time/$'</span>, current_datetime),</div><div class="line">    (<span class="string">'^another-time-page/$'</span>, current_datetime),</div><div class="line">)</div></pre></td></tr></table></figure></p>
<h4 id="动态URL"><a href="#动态URL" class="headerlink" title="动态URL"></a>动态URL</h4><p><strong>urls.py</strong> :<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.conf.urls.defaults <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> mysite.views <span class="keyword">import</span> hello, current_datetime, hours_ahead</div><div class="line"></div><div class="line">urlpatterns = patterns(<span class="string">''</span>,</div><div class="line">    (<span class="string">r'^hello/$'</span>, hello),</div><div class="line">    (<span class="string">r'^time/$'</span>, current_datetime),</div><div class="line">    (<span class="string">r'^time/plus/(\d&#123;1,2&#125;)/$'</span>, hours_ahead),</div><div class="line">)</div></pre></td></tr></table></figure></p>
<p><strong>views.py</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> Http404, HttpResponse</div><div class="line"><span class="keyword">import</span> datetime</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hours_ahead</span><span class="params">(request, offset)</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        offset = int(offset)</div><div class="line">    <span class="keyword">except</span> ValueError:</div><div class="line">        <span class="keyword">raise</span> Http404()</div><div class="line">    dt = datetime.datetime.now() + datetime.timedelta(hours=offset)</div><div class="line">    html = <span class="string">"&lt;html&gt;&lt;body&gt;In %s hour(s), it will be %s.&lt;/body&gt;&lt;/html&gt;"</span> % (offset, dt)</div><div class="line">    <span class="keyword">return</span> HttpResponse(html)</div></pre></td></tr></table></figure></p>
<blockquote><br>视图函数, hours_ahead , 有 两个 参数: request 和 offset . (见上)<br><br>request 是一个 HttpRequest 对象, 就像在 current_datetime 中一样. 再说一次好了: 每一个视图 总是 以一个 HttpRequest 对象作为 它的第一个参数。 (见上)<br><br>offset 是从匹配的URL里提取出来的。 例如：如果请求URL是/time/plus/3/，那么offset将会是3；如果请求URL是/time/plus/21/，那么offset将会是21。请注意：捕获值永远都是字符串（string）类型，而不会是整数（integer）类型，即使这个字符串全由数字构成（如：“21”）。<br><br>（从技术上来说，捕获值总是Unicode objects，而不是简单的Python字节串，但目前不需要担心这些差别。）<br><br>在这里我们命名变量为 offset ，你也可以任意命名它，只要符合Python 的语法。 变量名是无关紧要的，重要的是它的位置，它是这个函数的第二个 参数 (在 request 的后面）。 你还可以使用关键字来定义它，而不是用 位置。<br><br>我们在这个函数中要做的第一件事情就是在 offset 上调用 int() . 这会把这个字符串值转换为整数。<br><br>请留意：如果你在一个不能转换成整数类型的值上调用int()，Python将抛出一个ValueError异常。如：int(‘foo’)。在这个例子中，如果我们遇到ValueError异常，我们将转为抛出django.http.Http404异常——正如你想象的那样：最终显示404页面（提示信息：页面不存在）。<br><br>机灵的读者可能会问： 我们在URL模式中用正则表达式(d{1,2})约束它，仅接受数字怎么样？这样无论如何，offset都是由数字构成的。 答案是：我们不会这么做，因为URLpattern提供的是“适度但有用”级别的输入校验。万一这个视图函数被其它方式调用，我们仍需自行检查ValueError。 实践证明，在实现视图函数时，不臆测参数值的做法是比较好的。 松散耦合，还记得么？<br><br>下一行，计算当前日期/时间，然后加上适当的小时数。 在current_datetime视图中，我们已经见过datetime.datetime.now()。这里新的概念是执行日期/时间的算术操作。我们需要创建一个datetime.timedelta对象和增加一个datetime.datetime对象。 结果保存在变量dt中。<br><br>这一行还说明了，我们为什么在offset上调用int()——datetime.timedelta函数要求hours参数必须为整数类型。<br><br>这行和前面的那行的的一个微小差别就是，它使用带有两个值的Python的格式化字符串功能， 而不仅仅是一个值。 因此，在字符串中有两个 %s 符号和一个以进行插入的值的元组： (offset, dt) 。<br><br>最终，返回一个HTML的HttpResponse。 如今，这种方式已经过时了。<br></blockquote>




<h3 id="网站根目录"><a href="#网站根目录" class="headerlink" title="网站根目录"></a>网站根目录</h3><p>在最后一节，如果你想通过<a href="http://127.0.0.1:8000/看网站根目录你将看到一个404错误消息。Django不会增加任何东西在网站根目录，在任何情况下这个URL都不是特殊的" target="_blank" rel="external">http://127.0.0.1:8000/看网站根目录你将看到一个404错误消息。Django不会增加任何东西在网站根目录，在任何情况下这个URL都不是特殊的</a> 就像在URLconf中的其他条目一样，它也依赖于指定给它的URL模式.  </p>
<p>尽管匹配网站根目录的URL模式不能想象，但是还是值得提一下的. 当为网站根目录实现一个视图，你需要使用URL模式<code>‘^$’</code> , 它代表一个空字符串。 例如:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> mysite.views <span class="keyword">import</span> hello, my_homepage_view</div><div class="line"></div><div class="line">urlpatterns = patterns(<span class="string">''</span>,</div><div class="line">    (<span class="string">'^$'</span>, my_homepage_view),</div><div class="line">    <span class="comment"># ...</span></div><div class="line">)</div></pre></td></tr></table></figure></p>
<h3 id="Django怎样处理请求"><a href="#Django怎样处理请求" class="headerlink" title="Django怎样处理请求"></a>Django怎样处理请求</h3><p>所有均开始于setting文件。当你运行python manage.py runserver，脚本将在于manage.py同一个目录下查找名为setting.py的文件。这个文件包含了所有有关这个Django项目的配置信息，均大写： TEMPLATE_DIRS , DATABASE_NAME , 等. 最重要的设置时ROOT_URLCONF，它将作为URLconf告诉Django在这个站点中那些Python的模块将被用到</p>
<p>当访问 URL /hello/ 时，Django 根据 ROOT_URLCONF 的设置装载 URLconf 。 然后按顺序逐个匹配URLconf里的URLpatterns，直到找到一个匹配的。 当找到这个匹配 的URLpatterns就调用相关联的view函数，并把 HttpRequest 对象作为第一个参数。 （稍后再给出 HttpRequest 的更多信息） （我们将在后面看到HttpRequest的标准）</p>
<p>总结一下：</p>
<ol>
<li>进来的请求转入/hello/.</li>
<li>Django通过在ROOT_URLCONF配置来决定根URLconf.</li>
<li>Django在URLconf中的所有URL模式中，查找第一个匹配/hello/的条目。</li>
<li>如果找到匹配，将调用相应的视图函数</li>
<li>视图函数返回一个HttpResponse</li>
<li>Django转换HttpResponse为一个适合的HTTP response， 以Web page显示出来</li>
</ol>
<h3 id="Django-漂亮的出错页面"><a href="#Django-漂亮的出错页面" class="headerlink" title="Django 漂亮的出错页面"></a>Django 漂亮的出错页面</h3><p>花几分钟时间欣赏一下我们写好的Web应用程序，然后我们再来搞点小破坏。 我们故意在 views.py 文件中引入一项 Python 错误，注释掉 hours_ahead 视图中的 offset = int(offset) 一行。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hours_ahead</span><span class="params">(request, offset)</span>:</span></div><div class="line">    <span class="comment"># try:</span></div><div class="line">    <span class="comment">#     offset = int(offset)</span></div><div class="line">    <span class="comment"># except ValueError:</span></div><div class="line">    <span class="comment">#     raise Http404()</span></div><div class="line">    dt = datetime.datetime.now() + datetime.timedelta(hours=offset)</div><div class="line">    html = <span class="string">"&lt;html&gt;&lt;body&gt;In %s hour(s), it will be %s.&lt;/body&gt;&lt;/html&gt;"</span> % (offset, dt)</div><div class="line">    <span class="keyword">return</span> HttpResponse(html)</div></pre></td></tr></table></figure></p>
<p>这个例子是为了展示 Django 的出错页面。 我们来花些时间看一看这个出错页，了解一下其中 给出了哪些信息。</p>
<p>以下是值得注意的一些要点：</p>
<blockquote><br>在页面顶部，你可以得到关键的异常信息： 异常数据类型、异常的参数 (如本例中的 “unsupported type” ）、在哪个文件中引发了异常、出错的行号等等。<br><br>在关键异常信息下方，该页面显示了对该异常的完整 Python 追踪信息。 这类似于你在 Python 命令行解释器中获得的追溯信息，只不过后者更具交互性。 对栈中的每一帧，Django 均显示了其文件名、函数或方法名、行号及该行源代码。<br><br>点击该行代码 (以深灰色显示)，你可以看到出错行的前后几行，从而得知相关上下文情况。<br><br>点击栈中的任何一帧的“Local vars”可以看到一个所有局部变量的列表，以及在出错 那一帧时它们的值。 这些调试信息相当有用。<br><br>注意“Traceback”下面的“Switch to copy-and-paste view”文字。 点击这些字，追溯会 切换另一个视图，它让你很容易地复制和粘贴这些内容。 当你想同其他人分享这些异常 追溯以获得技术支持时（比如在 Django 的 IRC 聊天室或邮件列表中），可以使用它。<br><br>你按一下下面的“Share this traceback on a public Web site”按钮，它将会完成这项工作。 点击它以传回追溯信息至<a href="http://www.dpaste.com/，在那里你可以得到一个单独的URL并与其他人分享你的追溯信息。" target="_blank" rel="external">http://www.dpaste.com/，在那里你可以得到一个单独的URL并与其他人分享你的追溯信息。</a><br><br>接下来的“Request information”部分包含了有关产生错误的 Web 请求的大量信息： GET 和 POST、cookie 值、元数据（象 CGI 头）。 在附录H里给出了request的对象的 完整参考。<br><br>Request信息的下面，“Settings”列出了 Django 使用的具体配置信息。 （我们已经提及过ROOT_URLCONF，接下来我们将向你展示各式的Django设置。 附录D覆盖了所有可用的设置。）<br></blockquote>  

<p>Django 的出错页某些情况下有能力显示更多的信息，比如模板语法错误。 我们讨论 Django 模板系统时再说它们。 现在，取消 offset = int(offset) 这行的注释，让它重新正常 工作。</p>
<p>不知道你是不是那种使用小心放置的 print 语句来帮助调试的程序员？ 你其实可以用 Django 出错页来做这些，而不用 print 语句。 在你视图的任何位置，临时插入一个 assert False 来触发出错页。 然后，你就可以看到局部变量和程序语句了。 这里有个使用hours_ahead视图的例子：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hours_ahead</span><span class="params">(request, offset)</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        offset = int(offset)</div><div class="line">    <span class="keyword">except</span> ValueError:</div><div class="line">        <span class="keyword">raise</span> Http404()</div><div class="line">    dt = datetime.datetime.now() + datetime.timedelta(hours=offset)</div><div class="line">    <span class="keyword">assert</span> <span class="keyword">False</span></div><div class="line">    html = <span class="string">"&lt;html&gt;&lt;body&gt;In %s hour(s), it will be %s.&lt;/body&gt;&lt;/html&gt;"</span> % (offset, dt)</div><div class="line">    <span class="keyword">return</span> HttpResponse(html)</div></pre></td></tr></table></figure></p>
<p>最后，很显然这些信息很多是敏感的，它暴露了你 Python 代码的内部结构以及 Django 配置，在 Internet 上公开这信息是很愚蠢的。 不怀好意的人会尝试使用它攻击你的 Web 应用程序，做些下流之事。 因此，Django 出错信息仅在 debug 模式下才会显现。 我们稍后 说明如何禁用 debug 模式。 现在，你只要知道 Django 服务器在你开启它时默认运行在 debug 模式就行了。 （听起来很熟悉？ 页面没有发现错误，如前所述，工作正常。）</p>
<hr>
<h3 id="声明："><a href="#声明：" class="headerlink" title="声明："></a>声明：</h3><p><strong> 欢迎转载，转载时请注明出处，请尊重知识和劳动！</strong></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/Python基础例子小结/2016/10/20/" rel="next" title="Python例子小结">
                <i class="fa fa-chevron-left"></i> Python例子小结
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/Django-Web框架摘要-二/2016/10/29/" rel="prev" title="Django Web框架摘要(二)">
                Django Web框架摘要(二) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="Django-Web框架摘要(一)/2016/10/29/"
     data-title="Django Web框架摘要(一)"
     data-content=""
     data-url="http://yoursite.com/Django-Web框架摘要(一)/2016/10/29/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="Django-Web框架摘要(一)/2016/10/29/"
           data-title="Django Web框架摘要(一)" data-url="http://yoursite.com/Django-Web框架摘要(一)/2016/10/29/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="JacobYRJ" />
          <p class="site-author-name" itemprop="name">JacobYRJ</p>
          <p class="site-description motion-element" itemprop="description">fighting!fighting!fighting!</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">10</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/JacobYRJ" target="_blank" title="github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  github
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#介绍Django："><span class="nav-number">1.</span> <span class="nav-text">介绍Django：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#简介："><span class="nav-number">1.1.</span> <span class="nav-text">简介：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#安装Trunk版本"><span class="nav-number">1.2.</span> <span class="nav-text">安装Trunk版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Django数据库"><span class="nav-number">1.3.</span> <span class="nav-text">Django数据库</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#视图和URL配置"><span class="nav-number">2.</span> <span class="nav-text">视图和URL配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#view-py"><span class="nav-number">2.1.</span> <span class="nav-text">view.py</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#urls-py"><span class="nav-number">2.2.</span> <span class="nav-text">urls.py</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#URLpattern语法"><span class="nav-number">2.3.</span> <span class="nav-text">URLpattern语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#正则表达式"><span class="nav-number">2.4.</span> <span class="nav-text">正则表达式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#URL配置和松耦合"><span class="nav-number">2.5.</span> <span class="nav-text">URL配置和松耦合</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#动态URL"><span class="nav-number">2.6.</span> <span class="nav-text">动态URL</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#网站根目录"><span class="nav-number">3.</span> <span class="nav-text">网站根目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Django怎样处理请求"><span class="nav-number">4.</span> <span class="nav-text">Django怎样处理请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Django-漂亮的出错页面"><span class="nav-number">5.</span> <span class="nav-text">Django 漂亮的出错页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#声明："><span class="nav-number">6.</span> <span class="nav-text">声明：</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JacobYRJ</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/VEN/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/VEN/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/VEN/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/VEN/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/VEN/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/VEN/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"JacobYRJ"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/VEN/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("n9eXnIy0IFoUCLrw6D0SgPa2-gzGzoHsz", "SQWCDRNfKamzvkE0z5WSqqkr");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>

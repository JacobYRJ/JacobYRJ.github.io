<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/VEN/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/VEN/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="模板（Template）模板用法直接将HTML硬编码到你的视图里却并不是一个好主意。 让我们来看一下为什么：

对页面设计进行的任何改变都必须对 Python 代码进行相应的修改。 站点设计的修改往往比底层 Python 代码的修改要频繁得多，因此如果可以在不进行 Python 代码修改的情况下变更设计，那将会方便得多。
Python 代码编写和 HTML 设计是两项不同的工作，大多数专业的网站开">
<meta property="og:type" content="article">
<meta property="og:title" content="Django Web框架摘要(二)">
<meta property="og:url" content="http://yoursite.com/Django-Web框架摘要-二/2016/10/29/index.html">
<meta property="og:site_name" content="A Little Boy">
<meta property="og:description" content="模板（Template）模板用法直接将HTML硬编码到你的视图里却并不是一个好主意。 让我们来看一下为什么：

对页面设计进行的任何改变都必须对 Python 代码进行相应的修改。 站点设计的修改往往比底层 Python 代码的修改要频繁得多，因此如果可以在不进行 Python 代码修改的情况下变更设计，那将会方便得多。
Python 代码编写和 HTML 设计是两项不同的工作，大多数专业的网站开">
<meta property="og:updated_time" content="2016-11-03T10:21:17.397Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Django Web框架摘要(二)">
<meta name="twitter:description" content="模板（Template）模板用法直接将HTML硬编码到你的视图里却并不是一个好主意。 让我们来看一下为什么：

对页面设计进行的任何改变都必须对 Python 代码进行相应的修改。 站点设计的修改往往比底层 Python 代码的修改要频繁得多，因此如果可以在不进行 Python 代码修改的情况下变更设计，那将会方便得多。
Python 代码编写和 HTML 设计是两项不同的工作，大多数专业的网站开">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/Django-Web框架摘要-二/2016/10/29/"/>


  <title> Django Web框架摘要(二) | A Little Boy </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="default">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">A Little Boy</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">人生苦短</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      
        
        <li class="menu-item menu-item-comments">
          <a href="/comments" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />
            
            comments
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Django Web框架摘要(二)
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-10-29T20:41:53+08:00" content="2016-10-29">
              2016-10-29
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/Django-Web框架摘要-二/2016/10/29/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="Django-Web框架摘要-二/2016/10/29/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/Django-Web框架摘要-二/2016/10/29/" class="leancloud_visitors" data-flag-title="Django Web框架摘要(二)">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">visitors </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="模板（Template）"><a href="#模板（Template）" class="headerlink" title="模板（Template）"></a>模板（Template）</h2><h3 id="模板用法"><a href="#模板用法" class="headerlink" title="模板用法"></a>模板用法</h3><p>直接将HTML硬编码到你的视图里却并不是一个好主意。 让我们来看一下为什么：</p>
<ul>
<li>对页面设计进行的任何改变都必须对 Python 代码进行相应的修改。 站点设计的修改往往比底层 Python 代码的修改要频繁得多，因此如果可以在不进行 Python 代码修改的情况下变更设计，那将会方便得多。</li>
<li>Python 代码编写和 HTML 设计是两项不同的工作，大多数专业的网站开发环境都将他们分配给不同的人员（甚至不同部门）来完成。 设计者和HTML/CSS的编码人员不应该被要求去编辑Python的代码来完成他们的工作。</li>
<li>程序员编写 Python代码和设计人员制作模板两项工作同时进行的效率是最高的，远胜于让一个人等待另一个人完成对某个既包含 Python又包含 HTML 的文件的编辑工作。</li>
</ul>
<p>基于这些原因，将页面的设计和Python的代码分离开会更干净简洁更容易维护。 我们可以使用 Django的 模板系统 (Template System)来实现这种模式，这就是本章要具体讨论的问题。  </p>
<p>在Python代码中使用Django模板的最基本方式如下：</p>
<ol>
<li>可以用原始的模板代码字符串创建一个 Template 对象， Django同样支持用指定模板文件路径的方式来创建 Template 对象;</li>
<li>调用模板对象的render方法，并且传入一套变量context。它将返回一个基于模板的展现字符串，模板中的变量和标签会被context值替换。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from django import template</div><div class="line">&gt;&gt;&gt; t = template.Template(&apos;My name is &#123;&#123; name &#125;&#125;.&apos;)</div><div class="line">&gt;&gt;&gt; c = template.Context(&#123;&apos;name&apos;: &apos;Adrian&apos;&#125;)</div><div class="line">&gt;&gt;&gt; print t.render(c)</div><div class="line">My name is Adrian.</div><div class="line">&gt;&gt;&gt; c = template.Context(&#123;&apos;name&apos;: &apos;Fred&apos;&#125;)</div><div class="line">&gt;&gt;&gt; print t.render(c)</div><div class="line">My name is Fred.</div></pre></td></tr></table></figure>
<p>系统会在下面的情形抛出 TemplateSyntaxError 异常：</p>
<ul>
<li>无效的tags</li>
<li>标签的参数无效</li>
<li>无效的过滤器</li>
<li>过滤器的参数无效</li>
<li>无效的模板语法</li>
<li>未封闭的块标签 （针对需要封闭的块标签）</li>
</ul>
<h4 id="模板渲染"><a href="#模板渲染" class="headerlink" title="模板渲染"></a>模板渲染</h4><p>下面是编写模板并渲染的示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from django.template import Template, Context</div><div class="line">&gt;&gt;&gt; raw_template = &quot;&quot;&quot;&lt;p&gt;Dear &#123;&#123; person_name &#125;&#125;,&lt;/p&gt;</div><div class="line">...</div><div class="line">... &lt;p&gt;Thanks for placing an order from &#123;&#123; company &#125;&#125;. It&apos;s scheduled to</div><div class="line">... ship on &#123;&#123; ship_date|date:&quot;F j, Y&quot; &#125;&#125;.&lt;/p&gt;</div><div class="line">...</div><div class="line">... &#123;% if ordered_warranty %&#125;</div><div class="line">... &lt;p&gt;Your warranty information will be included in the packaging.&lt;/p&gt;</div><div class="line">... &#123;% else %&#125;</div><div class="line">... &lt;p&gt;You didn&apos;t order a warranty, so you&apos;re on your own when</div><div class="line">... the products inevitably stop working.&lt;/p&gt;</div><div class="line">... &#123;% endif %&#125;</div><div class="line">...</div><div class="line">... &lt;p&gt;Sincerely,&lt;br /&gt;&#123;&#123; company &#125;&#125;&lt;/p&gt;&quot;&quot;&quot;</div><div class="line">&gt;&gt;&gt; t = Template(raw_template)</div><div class="line">&gt;&gt;&gt; import datetime</div><div class="line">&gt;&gt;&gt; c = Context(&#123;&apos;person_name&apos;: &apos;John Smith&apos;,</div><div class="line">...     &apos;company&apos;: &apos;Outdoor Equipment&apos;,</div><div class="line">...     &apos;ship_date&apos;: datetime.date(2009, 4, 2),</div><div class="line">...     &apos;ordered_warranty&apos;: False&#125;)</div><div class="line">&gt;&gt;&gt; t.render(c)</div><div class="line">u&quot;&lt;p&gt;Dear John Smith,&lt;/p&gt;\n\n&lt;p&gt;Thanks for placing an order from Outdoor</div><div class="line">Equipment. It&apos;s scheduled to\nship on April 2, 2009.&lt;/p&gt;\n\n\n&lt;p&gt;You</div><div class="line">didn&apos;t order a warranty, so you&apos;re on your own when\nthe products</div><div class="line">inevitably stop working.&lt;/p&gt;\n\n\n&lt;p&gt;Sincerely,&lt;br /&gt;Outdoor Equipment</div><div class="line">&lt;/p&gt;&quot;</div></pre></td></tr></table></figure>
<p>让我们逐步来分析下这段代码：</p>
<blockquote><br>首先我们导入 （import）类 Template 和 Context ，它们都在模块 django.template 里。<br><br>我们把模板原始文本保存到变量 raw_template 。注意到我们使用了三个引号来 标识这些文本，因为这样可以包含多行。<br><br>接下来，我们创建了一个模板对象 t ，把 raw_template 作为 Template 类构造函数的参数。<br><br>我们从Python的标准库导入 datetime 模块，以后我们将会使用它。1<br><br>然后，我们创建一个 Context 对象， c 。 Context 构造的参数是Python 字典数据类型。 在这里，我们指定参数 person_name 的值是 ‘John Smith’ , 参数company 的值为 ‘Outdoor Equipment’ ，等等。<br><br>最后，我们在模板对象上调用 render() 方法，传递 context参数给它。 这是返回渲染后的模板的方法，它会替换模板变量为真实的值和执行块标签。<br><br>注意，warranty paragraph显示是因为 ordered_warranty 的值为 True . 注意时间的显示， April 2, 2009 , 它是按 ‘F j, Y’ 格式显示的。<br><br>如果你是Python初学者，你可能在想为什么输出里有回车换行的字符(‘\n’ )而不是 显示回车换行？ 因为这是Python交互解释器的缘故： 调用 t.render(c) 返回字符串， 解释器缺省显示这些字符串的 真实内容呈现 ，而不是打印这个变量的值。 要显示换行而不是 ‘\n’ ，使用 print 语句： print t.render(c) 。<br></blockquote>

<h4 id="高效渲染"><a href="#高效渲染" class="headerlink" title="高效渲染"></a>高效渲染</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Bad</span></div><div class="line"><span class="keyword">for</span> name <span class="keyword">in</span> (<span class="string">'John'</span>, <span class="string">'Julie'</span>, <span class="string">'Pat'</span>):</div><div class="line">    t = Template(<span class="string">'Hello, &#123;&#123; name &#125;&#125;'</span>)</div><div class="line">    <span class="keyword">print</span> t.render(Context(&#123;<span class="string">'name'</span>: name&#125;))</div><div class="line"></div><div class="line"><span class="comment"># Good</span></div><div class="line">t = Template(<span class="string">'Hello, &#123;&#123; name &#125;&#125;'</span>)</div><div class="line"><span class="keyword">for</span> name <span class="keyword">in</span> (<span class="string">'John'</span>, <span class="string">'Julie'</span>, <span class="string">'Pat'</span>):</div><div class="line">    <span class="keyword">print</span> t.render(Context(&#123;<span class="string">'name'</span>: name&#125;))</div></pre></td></tr></table></figure>
<h4 id="句点"><a href="#句点" class="headerlink" title="句点"></a>句点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from django.template import Template, Context</div><div class="line">&gt;&gt;&gt; import datetime</div><div class="line">&gt;&gt;&gt; d = datetime.date(1993, 5, 2)</div><div class="line">&gt;&gt;&gt; d.year</div><div class="line">1993</div><div class="line">&gt;&gt;&gt; d.month</div><div class="line">5</div><div class="line">&gt;&gt;&gt; d.day</div><div class="line">2</div><div class="line">&gt;&gt;&gt; t = Template(&apos;The month is &#123;&#123; date.month &#125;&#125; and the year is &#123;&#123; date.year &#125;&#125;.&apos;)</div><div class="line">&gt;&gt;&gt; c = Context(&#123;&apos;date&apos;: d&#125;)</div><div class="line">&gt;&gt;&gt; t.render(c)</div><div class="line">u&apos;The month is 5 and the year is 1993.&apos;</div></pre></td></tr></table></figure>
<p>这个例子使用了一个自定义的类，演示了通过实例变量加一点(dots)来访问它的属性，这个方法适用于任意的对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from django.template import Template, Context</div><div class="line">&gt;&gt;&gt; class Person(object):</div><div class="line">...     def __init__(self, first_name, last_name):</div><div class="line">...         self.first_name, self.last_name = first_name, last_name</div><div class="line">&gt;&gt;&gt; t = Template(&apos;Hello, &#123;&#123; person.first_name &#125;&#125; &#123;&#123; person.last_name &#125;&#125;.&apos;)</div><div class="line">&gt;&gt;&gt; c = Context(&#123;&apos;person&apos;: Person(&apos;John&apos;, &apos;Smith&apos;)&#125;)</div><div class="line">&gt;&gt;&gt; t.render(c)</div><div class="line">u&apos;Hello, John Smith.&apos;</div></pre></td></tr></table></figure>
<p>一点提示： Python的列表是从0开始索引。 第一项的索引是0，第二项的是1，依此类推。</p>
<p>句点查找规则可概括为： 当模板系统在变量名中遇到点时，按照以下顺序尝试进行查找：</p>
<ul>
<li>字典类型查找 （比如 foo[“bar”] )</li>
<li>属性查找 (比如 foo.bar )</li>
<li>方法调用 （比如 foo.bar() )</li>
<li>列表类型索引查找 (比如 foo[bar] )</li>
</ul>
<h4 id="方法调用行为"><a href="#方法调用行为" class="headerlink" title="方法调用行为"></a>方法调用行为</h4><p>有些方法是有副作用的，好的情况下允许模板系统访问它们可能只是干件蠢事，坏的情况下甚至会引发安全漏洞。</p>
<p>例如，你的一个 BankAccount 对象有一个 delete() 方法。 如果某个模板中包含了像<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&#123; account.delete &#125;&#125;</div></pre></td></tr></table></figure></p>
<p>这样的标签，其中<code>account</code> 又是BankAccount 的一个实例，请注意在这个模板载入时，account对象将被删除。</p>
<p>要防止这样的事情发生，必须设置该方法的 alters_data 函数属性：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self)</span>:</span></div><div class="line">    <span class="comment"># Delete the account</span></div><div class="line">delete.alters_data = <span class="keyword">True</span></div></pre></td></tr></table></figure>
<p>模板系统不会执行任何以该方式进行标记的方法。 接上面的例子，如果模板文件里包含了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&#123; account.delete &#125;&#125;</div></pre></td></tr></table></figure></p>
<p>对象又具有 delete()方法，而且delete() 有alters_data=True这个属性，那么在模板载入时， delete()方法将不会被执行。 它将静静地错误退出。</p>
<h3 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h3><h4 id="if-else"><a href="#if-else" class="headerlink" title="if/else"></a>if/else</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% if %&#125;</div></pre></td></tr></table></figure>
<p>标签检查(evaluate)一个变量，如果这个变量为真（即，变量存在，非空，不是布尔值假），系统会显示在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;% if %&#125; </div><div class="line"></div><div class="line">&#123;% endif %&#125;</div></pre></td></tr></table></figure>
<p>之间的任何内容.  </p>
<p><strong>if</strong>  标签接受 and ， or 或者 not 关键字来对多个变量做判断 ，或者对变量取反（ not )  </p>
<h4 id="Python-的“真值”"><a href="#Python-的“真值”" class="headerlink" title="Python 的“真值”"></a>Python 的“真值”</h4><p>在Python和Django模板系统中，以下这些对象相当于布尔值的False:</p>
<ul>
<li>空列表([] )</li>
<li>空元组(() )</li>
<li>空字典({} )</li>
<li>空字符串(‘’ )</li>
<li>零值(0 )</li>
<li>特殊对象None</li>
<li>对象False（很明显）</li>
<li>提示：你也可以在自定义的对象里定义他们的布尔值属性(这个是python的高级用法)。  </li>
</ul>
<p>除以上几点以外的所有东西都视为<code>True</code>   </p>
<p><strong>if</strong> 标签不允许在同一个标签中同时使用 and 和 or ，因为逻辑上可能模糊的.</p>
<h4 id="for"><a href="#for" class="headerlink" title="for"></a>for</h4><p><strong>(因为hexo的缘故，有些模板符号不能打出来，所以用”\”代替）</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;\% for \%&#125;</div></pre></td></tr></table></figure>
<p>允许我们在一个序列上迭代。 与Python的 for 语句的情形类似，循环语法是 for X in Y ，Y是要迭代的序列而X是在每一个特定的循环中使用的变量名称。 每一次循环中，模板系统会渲染在 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;\% for \%&#125; </div><div class="line"></div><div class="line">&#123;\% endfor \%&#125;</div></pre></td></tr></table></figure>
<p> 之间的所有内容。</p>
<p>给标签增加一个 reversed 使得该列表被反向迭代：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;\% for athlete in athlete_list reversed \%&#125;</div><div class="line">...</div><div class="line">&#123;\% endfor \%&#125;</div></pre></td></tr></table></figure>
<p>可以嵌套使用 {\% for \%} 标签.  </p>
<p>在执行循环之前先检测列表的大小是一个通常的做法，当列表为空时输出一些特别的提示。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;\% if athlete_list \%&#125;</div><div class="line">    &#123;\% for athlete in athlete_list \%&#125;</div><div class="line">        &lt;p&gt;&#123;&#123; athlete.name &#125;&#125;&lt;/p&gt;</div><div class="line">    &#123;\% endfor \%&#125;</div><div class="line">&#123;\% else \%&#125;</div><div class="line">    &lt;p&gt;There are no athletes. Only computer programmers.&lt;/p&gt;</div><div class="line">&#123;\% endif \%&#125;</div></pre></td></tr></table></figure>
<p>因为这种做法十分常见，所以<code>for</code> 标签支持一个可选的<code>{\% empty \%}</code> 分句，通过它我们可以定义当列表为空时的输出内容 下面的例子与之前那个等价：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;\% for athlete in athlete_list \%&#125;</div><div class="line">    &lt;p&gt;&#123;&#123; athlete.name &#125;&#125;&lt;/p&gt;</div><div class="line">&#123;\% empty \%&#125;</div><div class="line">    &lt;p&gt;There are no athletes. Only computer programmers.&lt;/p&gt;</div><div class="line">&#123;\% endfor \%&#125;</div></pre></td></tr></table></figure>
<p>Django不支持退出循环操作。 如果我们想退出循环，可以改变正在迭代的变量，让其仅仅包含需要迭代的项目。 同理，Django也不支持continue语句，我们无法让当前迭代操作跳回到循环头部。  </p>
<p>执行次数计数器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;\% for item in todo_list \%&#125;</div><div class="line">    &lt;p&gt;&#123;&#123; for loop.counter &#125;&#125; : &#123;&#123; item &#125;&#125;&lt;/p&gt;</div><div class="line">&#123;\% endfor \%&#125;</div></pre></td></tr></table></figure>
<p>orloop.revcounter 是表示循环中剩余项的整型变量。 在循环初次执行时 forloop.revcounter 将被设置为序列中项的总数。 最后一次循环执行中，这个变量将被置1。</p>
<p>forloop.revcounter0 类似于 forloop.revcounter ，但它以0做为结束索引。 在第一次执行循环时，该变量会被置为序列的项的个数减1。</p>
<p>forloop.first 是一个布尔值，如果该迭代是第一次执行，那么它被置为<strong>True</strong>  </p>
<p>forloop.last 是一个布尔值；在最后一次执行循环时被置为True。</p>
<h4 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;\% ifequal \%&#125;</div></pre></td></tr></table></figure>
<p> 标签比较两个值，当他们相等时，显示在 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;\% ifequal \%&#125;</div><div class="line"></div><div class="line">&#123;\% endifequal \%&#125;</div></pre></td></tr></table></figure>
<p> 之中所有的值  </p>
<p>下面的例子比较两个模板变量 user 和 currentuser :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;\% ifequal user currentuser \%&#125;</div><div class="line">    &lt;h1&gt;Welcome!&lt;\h1&gt;</div><div class="line">&#123;\% end ifeuqal \%&#125;</div></pre></td></tr></table></figure>
<p>参数可以是硬编码的字符串，随便用单引号或者双引号引起来  </p>
<p>和 if 类似，  ifequal 支持可选的  else 标签  </p>
<p>只有模板变量，字符串，整数和小数可以作为  ifequal  标签的参数  </p>
<p>其他任何类型，例如Python的字典类型、列表类型、布尔类型，不能用在  ifequal  中  </p>
<p>如果你需要判断变量是真还是假，请使用  if  来替代  ifequal  。</p>
<h4 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;# This is comment #&#125;</div></pre></td></tr></table></figure>
<p>多行注释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;\% comment \%&#125;</div><div class="line"></div><div class="line">&#123;\% endcomment \%&#125;</div></pre></td></tr></table></figure>
<h4 id="过滤器-用“-”"><a href="#过滤器-用“-”" class="headerlink" title="过滤器 用“|”"></a>过滤器 用“|”</h4><h3 id="设计理念与局限"><a href="#设计理念与局限" class="headerlink" title="设计理念与局限"></a>设计理念与局限</h3><p>假定设计师不是 Python 程序员 。模板系统开发人员认为：模板通常由设计师而非程序员来编写，因此不应被假定拥有Python开发知识。  </p>
<p>目标并不是要发明一种编程语言 。目标是恰到好处地提供如分支和循环这一类编程式功能，这是进行与表现相关判断的基础。  </p>
<p><strong>换句话说,Django模板是一种为非编程人员设计的模板语言，只是其背后是数据处理才需要python人员进行编写，就是这样的说。</strong>  </p>
<h3 id="在视图中使用模板"><a href="#在视图中使用模板" class="headerlink" title="在视图中使用模板"></a>在视图中使用模板</h3><p>你可能首先考虑把模板保存在文件系统的某个位置并用 Python 内建的文件操作函数来读取文件内容。 假设文件保存在 /home/djangouser/templates/mytemplate.html </p>
<h4 id="模板加载"><a href="#模板加载" class="headerlink" title="模板加载"></a>模板加载</h4><p>马上打开你的settings.py配置文件，找到TEMPLATE_DIRS这项设置。  </p>
<p>选择一个目录用于存放模板并将其添加到 TEMPLATE_DIRS 中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">TEMPLATE_DIRS = (</div><div class="line">    <span class="string">'/home/django/mysite/templates'</span>,</div><div class="line">)</div></pre></td></tr></table></figure>
<blockquote><br>Python 要求单元素元组中必须使用逗号，以此消除与圆括号表达式之间的歧义。<br><br><br>如果使用的是 Windows 平台，请包含驱动器符号并使用Unix风格的斜杠（/）而不是反斜杠（）<br><br>最省事的方式是使用绝对路径（即从文件系统根目录开始的目录路径）。 如果想要更灵活一点并减少一些负面干扰，可利用 Django 配置文件就是 Python 代码这一点来动态构建 TEMPLATE_DIRS 的内容<br><br>在这里我们面对的是动态语言python代码，我需要提醒你的是，不要在你的设置文件里写入错误的代码，这很重要。 如果你在这里引入了语法错误，或运行错误，你的Django-powered站点将很可能就要被崩溃掉。<br></blockquote>


<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os.path</div><div class="line"></div><div class="line">TEMPLATE_DIRS = (</div><div class="line">    os.path.join(os.path.dirname(__file__), <span class="string">'templates'</span>).replace(<span class="string">'\\'</span>,<span class="string">'/'</span>),</div><div class="line">)</div></pre></td></tr></table></figure>
<p>返回 current_datetime 视图，进行如下修改：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.template.loader <span class="keyword">import</span> get_template</div><div class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> Context</div><div class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</div><div class="line"><span class="keyword">import</span> datetime</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">current_datetime</span><span class="params">(request)</span>:</span></div><div class="line">    now = datetime.datetime.now()</div><div class="line">    t = get_template(<span class="string">'current_datetime.html'</span>)</div><div class="line">    html = t.render(Context(&#123;<span class="string">'current_date'</span>: now&#125;))</div><div class="line">    <span class="keyword">return</span> HttpResponse(html)</div></pre></td></tr></table></figure>
<p>OR 使用<strong>render_to_response()</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render_to_response</div><div class="line"><span class="keyword">import</span> datetime</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">current_datetime</span><span class="params">(request)</span>:</span></div><div class="line">    now = datetime.datetime.now()</div><div class="line">    <span class="keyword">return</span> render_to_response(<span class="string">'current_datetime.html'</span>, &#123;<span class="string">'current_date'</span>: now&#125;)</div></pre></td></tr></table></figure>
<p>render_to_response() 的第一个参数必须是要使用的模板名称。 如果要给定第二个参数，那么该参数必须是为该模板创建 Context 时所使用的字典。 如果不提供第二个参数， render_to_response() 使用一个空字典。  </p>
<p>OR <strong>locals()</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">current_datetime</span><span class="params">(request)</span>:</span></div><div class="line">    current_date = datetime.datetime.now()</div><div class="line">    <span class="keyword">return</span> render_to_response(<span class="string">'current_datetime.html'</span>, locals())</div></pre></td></tr></table></figure>
<p>locals() 并没有带来多 大 的改进，但是如果有多个模板变量要界定而你又想偷懒，这种技术可以减少一些键盘输入。</p>
<p>使用 locals() 时要注意是它将包括 所有 的局部变量，它们可能比你想让模板访问的要多。 在前例中， locals() 还包含了 request 。对此如何取舍取决你的应用程序。</p>
<h4 id="include-模板标签"><a href="#include-模板标签" class="headerlink" title="include 模板标签"></a>include 模板标签</h4><p>在讲解了模板加载机制之后，我们再介绍一个利用该机制的内建模板标签： </p>
<p>下面的例子包含了 includes/nav.html 模板的内容:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;\% include &apos;nav.html&apos; \%&#125;</div></pre></td></tr></table></figure></p>
<p>下面的例子包含了以变量 template_name 的值为名称的模板内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;\% include template_name \%&#125;</div></pre></td></tr></table></figure></p>
<p>该标签允许在（模板中）包含其它的模板的内容。 标签的参数是所要包含的模板名称，可以是一个变量，也可以是用单/双引号硬编码的字符串。 每当在多个模板中出现相同的代码时，就应该考虑是否要使用 {\% include \%} 来减少重复。  </p>
<p>和在 get_template() 中一样， 对模板的文件名进行判断时会在所调取的模板名称之前加上来自 TEMPLATE_DIRS 的模板目录。</p>
<h4 id="模板继承"><a href="#模板继承" class="headerlink" title="模板继承"></a>模板继承</h4><p>第一步是定义 基础模板 ， 该框架之后将由 子模板 所继承。 以下是我们目前所讲述范例的基础模板：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;% block title %&#125;&#123;% endblock %&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>My helpful timestamp site<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    &#123;% block content %&#125;&#123;% endblock %&#125;</div><div class="line">    &#123;% block footer %&#125;</div><div class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Thanks for visiting my site.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    &#123;% endblock %&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>现在我们已经有了一个基本模板，我们可以修改 current_datetime.html 模板来 使用它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;\% extends &apos;base.html&apos; \%&#125;</div><div class="line"></div><div class="line">&#123;\% block title \%&#125;The current time&#123;\% endblock \%&#125;</div><div class="line"></div><div class="line">&#123;\% block content \%&#125;</div><div class="line">&lt;p&gt;It is now &#123;&#123; current_date &#125;&#125;.&lt;/p&gt;</div><div class="line">&#123;\% endblock \%&#125;</div></pre></td></tr></table></figure>
<p><strong>直接在标签中填写内容，如有标签没有填，表示使用基础模板中的默认值</strong></p>
<p>你可以根据需要使用任意多的继承次数。 使用继承的一种常见方式是下面的三层法：</p>
<ol>
<li>创建 base.html 模板，在其中定义站点的主要外观感受。 这些都是不常修改甚至从不修改的部分。</li>
<li>为网站的每个区域创建 base_SECTION.html 模板(例如, base_photos.html 和 base_forum.html )。这些模板对 base.html 进行拓展，并包含区域特定的风格与设计。</li>
<li>为每种类型的页面创建独立的模板，例如论坛页面或者图片库。 这些模板拓展相应的区域模板。</li>
</ol>
<p>以下是使用模板继承的一些诀窍：</p>
<ul>
<li>如果在模板中使用 {\% extends \%} ，必须保证其为模板中的第一个模板标记。 否则，模板继承将不起作用。</li>
<li>一般来说，基础模板中的 {\% block \%} 标签越多越好。 记住，子模板不必定义父模板中所有的代码块，因此你可以用合理的缺省值对一些代码块进行填充，然后只对子模板所需的代码块进行（重）定义。 俗话说，钩子越多越好。</li>
<li>如果发觉自己在多个模板之间拷贝代码，你应该考虑将该代码段放置到父模板的某个 {\% block \%} 中</li>
<li>如果你需要访问父模板中的块的内容，使用 这个标签吧，这一个魔法变量将会表现出父模板中的内容。 如果只想在上级代码块基础上添加内容，而不是全部重载，该变量就显得非常有用了。</li>
<li>不允许在同一个模板中定义多个同名的 {\% block \%} 。 存在这样的限制是因为block 标签的工作方式是双向的。 也就是说，block 标签不仅挖了一个要填的坑，也定义了在父模板中这个坑所填充的内容。如果模板中出现了两个相同名称的 {\% block \%} 标签，父模板将无从得知要使用哪个块的内容。</li>
<li>{\% extends \%} 对所传入模板名称使用的加载方法和 get_template() 相同。 也就是说，会将模板名称被添加到 TEMPLATE_DIRS 设置之后。</li>
<li>多数情况下， {\% extends \%} 的参数应该是字符串，但是如果直到运行时方能确定父模板名，这个参数也可以是个变量。 这使得你能够实现一些很酷的动态功能。</li>
</ul>
<hr>
<h2 id="声明："><a href="#声明：" class="headerlink" title="声明："></a>声明：</h2><p><strong> 欢迎转载，转载时请注明出处，请尊重知识和劳动！</strong></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/Django-Web框架摘要(一)/2016/10/29/" rel="next" title="Django Web框架摘要(一)">
                <i class="fa fa-chevron-left"></i> Django Web框架摘要(一)
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/Django-Web框架摘要-三/2016/11/13/" rel="prev" title="Django Web框架摘要(三)">
                Django Web框架摘要(三) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="Django-Web框架摘要-二/2016/10/29/"
     data-title="Django Web框架摘要(二)"
     data-content=""
     data-url="http://yoursite.com/Django-Web框架摘要-二/2016/10/29/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="Django-Web框架摘要-二/2016/10/29/"
           data-title="Django Web框架摘要(二)" data-url="http://yoursite.com/Django-Web框架摘要-二/2016/10/29/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="JacobYRJ" />
          <p class="site-author-name" itemprop="name">JacobYRJ</p>
          <p class="site-description motion-element" itemprop="description">fighting!fighting!fighting!</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">9</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/JacobYRJ" target="_blank" title="github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  github
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#模板（Template）"><span class="nav-number">1.</span> <span class="nav-text">模板（Template）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#模板用法"><span class="nav-number">1.1.</span> <span class="nav-text">模板用法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#模板渲染"><span class="nav-number">1.1.1.</span> <span class="nav-text">模板渲染</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#高效渲染"><span class="nav-number">1.1.2.</span> <span class="nav-text">高效渲染</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#句点"><span class="nav-number">1.1.3.</span> <span class="nav-text">句点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方法调用行为"><span class="nav-number">1.1.4.</span> <span class="nav-text">方法调用行为</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#标签"><span class="nav-number">1.2.</span> <span class="nav-text">标签</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#if-else"><span class="nav-number">1.2.1.</span> <span class="nav-text">if/else</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Python-的“真值”"><span class="nav-number">1.2.2.</span> <span class="nav-text">Python 的“真值”</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#for"><span class="nav-number">1.2.3.</span> <span class="nav-text">for</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#比较"><span class="nav-number">1.2.4.</span> <span class="nav-text">比较</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#注释"><span class="nav-number">1.2.5.</span> <span class="nav-text">注释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#过滤器-用“-”"><span class="nav-number">1.2.6.</span> <span class="nav-text">过滤器 用“|”</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设计理念与局限"><span class="nav-number">1.3.</span> <span class="nav-text">设计理念与局限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在视图中使用模板"><span class="nav-number">1.4.</span> <span class="nav-text">在视图中使用模板</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#模板加载"><span class="nav-number">1.4.1.</span> <span class="nav-text">模板加载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#include-模板标签"><span class="nav-number">1.4.2.</span> <span class="nav-text">include 模板标签</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模板继承"><span class="nav-number">1.4.3.</span> <span class="nav-text">模板继承</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#声明："><span class="nav-number">2.</span> <span class="nav-text">声明：</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JacobYRJ</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/VEN/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/VEN/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/VEN/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/VEN/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/VEN/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/VEN/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"JacobYRJ"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/VEN/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("n9eXnIy0IFoUCLrw6D0SgPa2-gzGzoHsz", "SQWCDRNfKamzvkE0z5WSqqkr");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
